<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2021-09-28">

<title>Timothy Wolodzko - Environment variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V9DH8RH1V5"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-V9DH8RH1V5', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Timothy Wolodzko</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/twolodzko"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bayes.club/@tymwol"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Environment variables</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 28, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Using environment variables for storing configuration is a de facto standard. It was <a href="https://www.cdta.org/sites/default/files/awards/beyond_the_12-factor_app_pivotal.pdf">one of the recommendations</a> from Heroku’s <a href="https://12factor.net/config">Twelve-Factor App</a> guide and has become widely adopted since then. We are all familiar with environment variables, but there are many, less known, yet nice to know subtleties.</p>
<p>I would be focusing on <a href="https://www.shell-tips.com/bash/environment-variables/">environment variables in Unixes</a>, such as Linux or macOS. Windows is a different story, I won’t be covering it here.</p>
<section id="environment-variables-in-linux-and-macos" class="level2">
<h2 class="anchored" data-anchor-id="environment-variables-in-linux-and-macos">1. Environment variables in Linux and macOS</h2>
<p>Shell variables are defined using the <a href="https://superuser.com/questions/18988/difference-between-a-b-and-export-a-b-in-bash">following syntax</a>:</p>
<pre class="shell"><code>export KEY=value</code></pre>
<p>It defines a variable that would be available within the enclosing shell and for all the [subprocesses of the shell] <a href="https://unix.stackexchange.com/questions/130985/if-processes-inherit-the-parents-environment-why-do-we-need-export">subprocess</a>. You can define <a href="https://bencane.com/2013/09/16/understanding-a-little-more-about-etcprofile-and-etcbashrc/">system-wide variables</a>, available for all the users, in the global /etc/profile config (you need to be root to edit it) or user-specific ~/.profile configurations. Additionally, there are shell-specific configurations like ~ /.bashrc for <a href="https://twolodzko.github.io/bash.html">Bash</a>, or ~/.zshrc for ZSH, etc. Unlike ~/.profile, they are used when running a particular <a href="https://stackoverflow.com/questions/7366775/what-does-the-line-bin-sh-mean-in-a-unix-shell-script">kind of shell</a>. Variables are accessed using the <code>$KEY</code> or <code>${KEY}</code> syntax.</p>
<p><a href="https://linuxhint.com/bash-variable-name-rules-legal-illegal/">Variable names</a> can consist of letters, digits, and underscores. By convention, only uppercase letters are allowed. Names with and without underscores are used, e.g.&nbsp;<code>LC_CTYPE</code>, <code>TMPDIR</code>, <code>PYTHONPATH</code>. To view all the currently defined environment variables, use the <code>env</code> command.</p>
<p>To avoid problems with character encoding non-ASCII data can be encoded using <a href="https://en.wikipedia.org/wiki/Base64">Base64</a>. You can use the <code>base64</code> build-in command-line tool or the utilities available for your programming language.</p>
</section>
<section id="command-line-usage" class="level2">
<h2 class="anchored" data-anchor-id="command-line-usage">2. Command-line usage</h2>
<p>To define a shell variable from the command-line you can use the local declaration:</p>
<pre class="shell"><code>$ NAME=Joe
$ echo "$NAME"
Joe</code></pre>
<p>However, such a variable would not be available for the subprocesses running within the shell. Consider the simple <code>hello.py</code> script:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> os.environ[<span class="st">'NAME'</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Hello </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It will not recognize the local variable:</p>
<pre class="shell"><code>$ NAME=Joe
$ python hello.py
Traceback (most recent call last):
  File "hello.py", line 3, in &lt;module&gt;
    name = os.environ['NAME']
  File "[...]/os.py", line 675, in __getitem__
    raise KeyError(key) from None
KeyError: 'NAME'</code></pre>
<p>For the variable to be visible within the subprocess, you either need to pass it inline:</p>
<pre class="shell"><code>$ NAME=Jenny python hello.py
Hello Jenny!
$ echo "$NAME"
Joe</code></pre>
<p>or export it beforehand:</p>
<pre class="shell"><code> $ export NAME=Bob
 $ python hello.py
Hello Bob!
 $ echo "$NAME"
Bob</code></pre>
</section>
<section id="passing-variables-through-the-ssh-connection" class="level2">
<h2 class="anchored" data-anchor-id="passing-variables-through-the-ssh-connection">3. Passing variables through the SSH connection</h2>
<p>Environment variable can <a href="https://superuser.com/questions/48783/how-can-i-pass-an-environment-variable-through-an-ssh-command">be passed through the SSH connection</a>. One use-case for this is that you can take your local configuration “with you” when connecting to a remote machine, rather than needing to configure it independently.</p>
</section>
<section id="accessing-environment-variables-from-the-code" class="level2">
<h2 class="anchored" data-anchor-id="accessing-environment-variables-from-the-code">4. Accessing environment variables from the code</h2>
<p>Programming languages commonly expose getters and setters for environment variables. In Go, there are <code>os.Getenv</code> and <code>os.Setenv</code>, in Python there are <code>os.getenv</code> and <code>os.setenv</code> functions, as well as the <code>os.environ</code> mapping object that behaves almost as a Python’s dict, but reads and writes to environment variables.</p>
<p>When using those functions, keep in mind that your program runs in a subshell, so setting or changing the variable would affect the subshell, but not the parent shell:</p>
<pre class="shell"><code> $ python
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.environ['NAME']
'Bob'
&gt;&gt;&gt; os.environ['NAME'] = 'Joe'
&gt;&gt;&gt; os.environ['NAME']
'Joe'
&gt;&gt;&gt; exit()
 $ echo "$NAME"
Bob</code></pre>
<p>Forgetting this may lead to bugs when trying to pass information between programs via the environment variables. This won’t work, because only the variables within the subshell are modified, rather than the “global” variables, as shown in the example above.</p>
</section>
<section id="the-.env-files" class="level2">
<h2 class="anchored" data-anchor-id="the-.env-files">5. The .env files</h2>
<p>Another popular solution is the .env files. The files are used for storing project-specific variables and can overwrite the already available variables. The <a href="https://smartmob-rfc.readthedocs.io/en/latest/2-dotenv.html">format of the .env file</a> is simple:</p>
<pre class="dotenv"><code>NAME=John
SURNAME=Doe
EMAIL=johndoe@example.com</code></pre>
<p>It can be loaded directly:</p>
<pre class="shell"><code> $ source .env
 $ python hello.py
Hello John!</code></pre>
<p>In many cases, this is won’t be needed, as the .env files are being auto-loaded by different software. If you are using the ZSH shell, the <a href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/dotenv">dotenv plugin</a> would auto-load a .env file each time you enter a directory containing it. The same is done by virtual environment management tools such as Python’s <a href="https://pipenv.pypa.io/en/latest/">Pipenv</a>.</p>
<p>There are many solutions for using .env files from code, for example, <a href="https://pypi.org/project/python-dotenv/">python-dotenv</a> or the much more sophisticated <a href="https://github.com/sloria/environs">environs</a> package for Python. Those packages will let you load and parse the .env files to read the configuration.</p>
<p>Since .env files often store sensitive data such as login credentials, it is a good practice to always keep them in <a href="https://www.atlassian.com/git/tutorials/saving-changes/gitignore">.gitignore</a>, so as not to accidentally expose them in a git repository.</p>
</section>
<section id="docker-containers-and-cloud-apps" class="level2">
<h2 class="anchored" data-anchor-id="docker-containers-and-cloud-apps">6. Docker containers and cloud apps</h2>
<p>Environment variables can be hardcoded for Docker containers using the <code>ENV key value</code> instruction in <a href="https://docs.docker.com/engine/reference/builder/#env">Dockerfile</a> <a href="https://docs.docker.com/engine/reference/builder/#env">dockerfile</a>. Such variables are accessible within the Dockerfile using the <code>${key}</code> syntax. They can also be easily <a href="https://stackoverflow.com/questions/30494050/how-do-i-pass-environment-variables-to-docker-containers">passed to a container</a> using the <code>-e</code> argument:</p>
<pre class="shell"><code>$ docker run -e NAME=Bill debian:stable-slim bash -c 'echo Hi $NAME!'
Hi Bill!</code></pre>
<p>Not only Heroku but also Kubernetes, its derivatives, different cloud platforms, and services let you pass environment variables to the virtual machines, containers, workflows, etc. While this is done differently depending on if you are using <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/">Kubernetes</a>, <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables">GitHub Actions</a>, <a href="https://www.jenkins.io/doc/pipeline/tour/environment/">Jenkins</a>, an MLOps platform, or something else, they would usually allow you to define a list of key-value pairs for the variables in a YAML configuration file. Usually, there would be two kinds of environment variables: the regular “env” ones and the “secret” variables. Secrets are implemented differently by different software, but commonly they are stored in encrypted form (but not always, for example, by default there is nothing secret about <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secrets in Kubernetes</a>) and are not directly accessible by the users. When passed to containers, they behave the same as regular environment variables. All this happens behind the scenes, but you should be aware of the difference.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>