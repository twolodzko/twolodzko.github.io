<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-01-06">

<title>Timothy Wolodzko - Makefile Programming Language Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'G-V9DH8RH1V5', { 'storage': 'none' });

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Timothy Wolodzko</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Makefile Programming Language Tutorial</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 6, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><a href="https://www.gnu.org/software/make/manual/make.html">Makefile</a> language is a <a href="https://okmij.org/ftp/Computation/#Makefile-functional">functional</a>, dynamically typed language, and of course, it <a href="https://stackoverflow.com/questions/3480950/are-makefiles-turing-complete/3480982#3480982">is Turing complete</a>. It’s probably the most popular, unpopular programming language, widely adopted in many programming projects (especially ones using C as the main language). While it shares many features with other functional languages, it has rather an unorthodox syntax.</p>
<p>In the following tutorial, I would be assuming that you are using a Unix-like operating system. GNU Make is probably already preinstalled, so you don’t need to do anything.</p>
<p>The code examples can be found <a href="https://github.com/twolodzko/twolodzko.github.io/blob/main/snippets/makefiles/">here</a>.</p>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>Makefiles have <a href="https://www.gnu.org/software/make/manual/make.html#Flavors">two flavors of variables</a>. The <em>simple expanded</em> variables work like ordinary variables, we can assign values to them (<code>:=</code>), access, and modify their values. Let’s take the following code as an example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">GREET </span><span class="ch">:=</span><span class="st"> Hi</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    echo <span class="ch">$(</span><span class="dt">GREET</span><span class="ch">)</span> World</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Makefile does not have a REPL environment, so to run it we first need to save it into a file, we’ll use variables.mk file for it. Next, we can run it using the <code>make</code> command:</p>
<pre class="shell"><code>$ make -f variables.mk
echo Hi World
Hi World</code></pre>
<p>Alternatively, a variable can be passed to the program when calling it:</p>
<pre class="shell"><code>$ make -f variables.mk GREET=Hello
echo Hello World
Hello World</code></pre>
<p>As you can see, the variable assignments are only used to define the default values. To set variables that could not be changed by the user, use the <a href="https://www.gnu.org/software/make/manual/html_node/Override-Directive.html#Override-Directive"><code>overwrite</code> keyword</a>.</p>
<p>Another kind of variable is the <em>recursively expanded</em>, assigned with <code>=</code>. Those variables behave similarly to pointers because they can point to other variables and will change when the variables they refer to change. This is best illustrated with an example.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">GREET </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MESSAGE</span><span class="ch">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">MESSAGE </span><span class="ch">:=</span><span class="st"> Hi</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="dt">GREET</span><span class="ch">)</span><span class="fu"> World  </span><span class="co"># with @ the command is not printed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we used instead</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="st">- GREET = $(MESSAGE)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">+ GREET := $(MESSAGE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and didn’t provide the value for neither <code>GREET</code> nor <code>MESSAGE</code>, <code>GREET</code> would be null by default and print as an empty string, like below.</p>
<pre class="shell"><code>$ make -f variables.mk
World</code></pre>
<p>However with <code>GREET = $(MESSAGE)</code>, it expands to the value it points to:</p>
<pre class="shell"><code>$ make -f variables.mk
Hi World
$ make -f variables.mk GREET=Hola
Hola World
$ make -f variables.mk MESSAGE=Hello
Hello World
$ make -f variables.mk GREET=Hola MESSAGE=Hello
Hola World</code></pre>
<p>Variables are defined by a convention on the top of the Makefile. They cannot be modified within the functions, the code below <em>won’t work</em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dv">invalid:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    MESSAGE := Hello</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="dt">MESSAGE</span><span class="ch">)</span><span class="fu"> World</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="shell"><code>$ make -f variables.mk invalid
MESSAGE := Hello
make: MESSAGE: No such file or directory
make: *** [invalid] Error 1</code></pre>
<p>What this means for us, is that we need to treat the data as immutable and embrace the functional programming style.</p>
</section>
<section id="lists" class="level2">
<h2 class="anchored" data-anchor-id="lists">Lists</h2>
<p>Like other lisps, Makefile natively supports list data structures and has several <a href="https://www.gnu.org/software/make/manual/make.html#Text-Functions">methods for interacting with lists</a>:</p>
<ul>
<li><code>$(words $(LIST))</code> returns the size of the <code>LIST</code>,</li>
<li><code>$(firstword $(LIST))</code> returns the first element of the <code>LIST</code>,</li>
<li><code>$(word $(N), $(LIST))</code> returns <code>N</code>th element of the <code>LIST</code>,</li>
<li><code>$(wordlist $(START), $(END), $(LIST))</code> returns elements from <code>START</code> to <code>END</code> (inclusive),</li>
<li><code>variable += value</code> adds <code>value</code> to <code>variable</code>, treating <code>variable</code> as a list.</li>
</ul>
<p>To do <code>(cons cat cdr)</code> as in Scheme, in Makefile we just need to construct it is a regular string <code>"$(CAT) $(CDR)"</code>.</p>
<p>Lists are passed as strings with elements separated by spaces, <code>LIST="1 2 3 4"</code> is a list of four elements. Unlike other lisps, Makefile does not have native support for lists of lists or other data structures, so implementing them is left as an exercise for the user.</p>
<p>Makefile has <code>foreach</code> and <code>filter</code> methods for working with lists that may be known to users of other functional programming languages (<code>foreach</code> corresponds to <code>map</code>). To implement the function that reduces the list, we need to use <a href="#recursion">recursion</a>.</p>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<p>Functions (or <em>targets</em> as they are called) in Makefile are defined by writing their name followed by <code>:</code>, where the code starts from the next line indented with <a href="https://stackoverflow.com/questions/2131213/can-you-make-valid-makefiles-without-tab-characters">tab</a> (sorry space users). The syntax might feel familiar to Python, Haskell, or OCaml programmers.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">GREET </span><span class="ch">:=</span><span class="st"> Hello</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dv">hello:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"</span><span class="ch">$(</span><span class="dt">GREET</span><span class="ch">)</span><span class="st"> World!"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">date:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> date</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, Makefile assumes <a href="https://stackoverflow.com/questions/2057689/how-does-make-app-know-default-target-to-build-if-no-target-is-specified">the first function</a> in the file to be the main entry point (like the <code>main</code> function in Go).</p>
<pre class="shell"><code>$ make -f functions.mk
Hello World!
$ make -f functions.mk date
Tue 4 Jan 20:47:28 CET 2022</code></pre>
<p>We can of course call functions from other functions. For example, we could define another function that would invoke the two functions above.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dv">message:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="fu"> -f functions.mk hello GREET=Hi</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"It's"</span><span class="fu"> </span><span class="st">"</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> -f functions.mk date</span><span class="ch">)</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To call the other functions, we used the <code>$(MAKE)</code> command. If directory contains only one Makefile, <code>$(MAKE)</code> alone can be used, but when there are multiple Makefiles available, we need to name the specific file. In the first line of the function, we called make alone, but in the second line its output was passed as an argument to another function, so we needed to call it with <code>$(shell command)</code> (see <a href="#interacting-with-other-programming-languages">below</a>).</p>
<p>The example above shows also how Makefile code can be grouped into <em>packages</em> (files) and imported. The <code>-f</code> syntax helps to distinguish the source of the function like Go (e.g.&nbsp;<code>fmt.Println</code>) or Python (e.g.&nbsp;<code>datetime.datetime</code>) do use the dot instead.</p>
<p>Remember that each line of the function is <a href="https://www.gnu.org/software/make/manual/html_node/Execution.html">executed in its own subshell</a> so they don’t share their states. This can be changed using <code>.ONESHELL</code> target.</p>
</section>
<section id="chained-functions" class="level2">
<h2 class="anchored" data-anchor-id="chained-functions">Chained functions</h2>
<p>Makefiles support chained execution of the functions, where a function can define its dependencies that will be called before executing it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dv">numbers:</span><span class="dt"> one two three</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="dv">one:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo One</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dv">two:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo Two</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="dv">three:</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo Three</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since the functions don’t share any state, the only way to pass data between them is through writing and reading files.</p>
</section>
<section id="conditionals" class="level2">
<h2 class="anchored" data-anchor-id="conditionals">Conditionals</h2>
<p>Makefile has four <a href="https://www.gnu.org/software/make/manual/make.html#Conditional-Syntax">conditional statements</a>: <code>ifeq</code> (two values are equal), <code>ifneq</code> (two values are not equal), <code>ifdef</code> (value is defined), and <code>ifndef</code> (value is not defined). The two latter methods, check if the variable was defined rather than if its value was set. If you want to check for an empty value, use</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">VARIABLE</span><span class="ch">)</span>, )</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># do things</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <a href="https://www.gnu.org/software/make/manual/make.html#Conditional-Syntax">conditional statements</a> can be chained</p>
<blockquote class="blockquote">
<p>conditional-directive-one text-if-one-is-true <code>else</code> conditional-directive-two text-if-two-is-true <code>else</code> text-if-one-and-two-are-false <code>endif</code></p>
</blockquote>
<p>The statements can sometimes be tricky. For example, calling <code>make -f conditionals.mk invalid</code> won’t work</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">VARIABLE </span><span class="ch">:=</span><span class="st"> 1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">cond:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">VARIABLE</span><span class="ch">)</span>, 1)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    echo 1</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    echo 0</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dv">invalid:</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> -f conditionals.mk cond</span><span class="ch">)</span>, 1)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    echo <span class="st">"it's 1"</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    echo <span class="st">"it's not 1"</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>because Makefile has a rather specific order of executing and expanding stuff. In fact, the Makefile with <code>invalid</code> rule won’t work at all, because Makefile won’t be able to parse a script that recursively calls <code>make</code> in the conditional statement. Instead, use something like the below:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dv">impl:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">CONDITION</span><span class="ch">)</span>, 1)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    echo <span class="st">"it's 1"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    echo <span class="st">"it's not 1"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="dv">valid:</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -f conditionals.mk impl CONDITION=<span class="st">"</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> -f conditionals.mk cond</span><span class="ch">)</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By doing this, we first call <code>cond</code> and pass the result to the <code>CONDITION</code> variable that is evaluated in the <code>ifeq</code> condition.</p>
<p>Since Makefile does not come with other comparison operators than checking for equality and inequality, they need to be implemented by the user using <a href="https://linuxhint.com/bash-test-command/">Bash <code>test</code> command</a> (or something else).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">less </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> test "</span><span class="ch">$(</span><span class="dt">1</span><span class="ch">)</span><span class="st">" \&lt; "</span><span class="ch">$(</span><span class="dt">2</span><span class="ch">)</span><span class="st">"; echo </span><span class="ch">$$</span><span class="st">?</span><span class="ch">)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dv">isless:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="kw">call</span><span class="st"> less</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">A</span><span class="ch">)</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">B</span><span class="ch">))</span>, 0)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"</span><span class="ch">$(</span><span class="dt">A</span><span class="ch">)</span><span class="st"> &lt; </span><span class="ch">$(</span><span class="dt">B</span><span class="ch">)</span><span class="st">"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"</span><span class="ch">$(</span><span class="dt">A</span><span class="ch">)</span><span class="st"> &gt;= </span><span class="ch">$(</span><span class="dt">B</span><span class="ch">)</span><span class="st">"</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Conditionals can be used also outside functions when defining variables.</p>
</section>
<section id="recursion" class="level2">
<h2 class="anchored" data-anchor-id="recursion">Recursion</h2>
<p>Makefile has a very simple syntax. Same as lisp, it doesn’t have for loops and instead we need to use <a href="https://www.gnu.org/software/make/manual/html_node/Recursion.html">recursion</a>. Consider the simple recursive function that sums elements of a <code>LIST</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">TOTAL </span><span class="ch">:=</span><span class="st"> 0</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">HEAD </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">firstword</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dt">TAIL </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wordlist</span><span class="st"> 2</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="kw">words</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">sum:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">LIST</span><span class="ch">)</span>, )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="dt">TOTAL</span><span class="ch">)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -f sum.mk <span class="dt">LIST</span><span class="ch">=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">TAIL</span><span class="ch">)</span><span class="st">" TOTAL=</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> expr </span><span class="ch">$(</span><span class="dt">TOTAL</span><span class="ch">)</span><span class="st"> + </span><span class="ch">$(</span><span class="dt">HEAD</span><span class="ch">))</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see, the function uses the <a href="https://www.quora.com/How-do-accumulators-work-in-OCaml"><em>accumulator</em> pattern</a>, common in functional programming languages. It iterates over <code>LIST</code>, chopping off elements from the beginning of the array and adding them to <code>TOTAL</code> variable that is printed at the end.</p>
<p>When using recursion, it may be a good idea to add <code>MAKEFLAGS += --no-print-directory</code> to the script. It will silence the Make messages informing about every new call to <code>make</code>.</p>
</section>
<section id="unit-testing" class="level2">
<h2 class="anchored" data-anchor-id="unit-testing">Unit testing</h2>
<p>While Makefile does not come out of a box with unit testing utilities, it can be easily implemented by the user. An example is shown below.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dv">testme:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> expr 2 + 2</span><span class="ch">)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dv">assert:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">RESULT</span><span class="ch">)</span>, <span class="ch">$(</span><span class="dt">EXPECTED</span><span class="ch">)</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">info</span><span class="st"> "OK!"</span><span class="ch">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">error</span><span class="st"> "Test failed"</span><span class="ch">)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="dv">test-testme:</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -f assert.mk assert RESULT=<span class="st">"</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> -f assert.mk testme</span><span class="ch">)</span><span class="st">"</span> EXPECTED=4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="metaprogramming-with-macros" class="level2">
<h2 class="anchored" data-anchor-id="metaprogramming-with-macros">Metaprogramming with macros</h2>
<p>While Makefile’s metaprogramming utilities are not as impressive as with some lisps, they still can be quite helpful. Makefile supports <a href="https://www.oreilly.com/library/view/managing-projects-with/0596006101/ch03.html">macros</a> in two forms. We saw one form of macros in the section on <a href="#conditionals">conditionals</a> when defining the <code>less</code> macro that was called using <code>$(call macro,args...)</code>. You might have noticed that in fact <code>less</code> is a named <a href="https://en.wikipedia.org/wiki/Anonymous_function">lambda function</a>.</p>
<p>The second kind of macro is declared using the <code>define</code> block and called the same way as variables. The second kind of macro is snippets of code that get pasted to the code at the execution time.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">define</span> date</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">shell</span><span class="st"> date</span><span class="ch">)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">endef</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="dt">sum </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> expr </span><span class="ch">$(</span><span class="dt">1</span><span class="ch">)</span><span class="st"> + </span><span class="ch">$(</span><span class="dt">2</span><span class="ch">))</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"Today is"</span><span class="fu"> </span><span class="st">"</span><span class="ch">$(</span><span class="dt">date</span><span class="ch">)</span><span class="st">"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="st">"2 + 2 ="</span><span class="fu"> </span><span class="ch">$(</span><span class="kw">call</span><span class="st"> sum</span><span class="kw">,</span><span class="st">2</span><span class="kw">,</span><span class="st">2</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="interacting-with-other-programming-languages" class="level2">
<h2 class="anchored" data-anchor-id="interacting-with-other-programming-languages">Interacting with other programming languages</h2>
<p>Makefiles can interact with any program that can be called from the command line. To do this, just use the <code>$(shell command)</code> that executes the <code>command</code> in Shell. This can be used for expanding <a href="#conditionals">conditionals</a> or for arithmetics using <code>expr</code>, etc.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>To give a slightly more complicated example, below I show the implementation of <a href="https://en.wikipedia.org/wiki/Quicksort">Quicksort</a> algorithm in Makefile. The code uses variables, calling internal functions with <code>$(MAKE)</code>, conditionals, and recursion.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MAKEFLAGS </span><span class="ch">+=</span><span class="st"> --no-print-directory</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">HEAD </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">firstword</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="dt">TAIL </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wordlist</span><span class="st"> 2</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="kw">words</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIST</span><span class="ch">))</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="dt">lt </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> test </span><span class="ch">$(</span><span class="dt">1</span><span class="ch">)</span><span class="st"> \&lt; </span><span class="ch">$(</span><span class="dt">2</span><span class="ch">)</span><span class="st">; echo </span><span class="ch">$$</span><span class="st">?</span><span class="ch">)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dv">sort:</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="fu"> impl LIST=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">TAIL</span><span class="ch">)</span><span class="st">"</span><span class="fu"> PIVOT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">HEAD</span><span class="ch">)</span><span class="st">"</span><span class="fu"> LEFT= RIGHT=</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dv">impl:</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">PIVOT</span><span class="ch">)</span>, )</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">LIST</span><span class="ch">)</span>, )</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> echo </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> LIST="</span><span class="ch">$(</span><span class="dt">LEFT</span><span class="ch">)</span><span class="st">"</span><span class="ch">)</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">PIVOT</span><span class="ch">)</span><span class="fu"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="st"> LIST="</span><span class="ch">$(</span><span class="dt">RIGHT</span><span class="ch">)</span><span class="st">"</span><span class="ch">)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">ifeq</span> (<span class="ch">$(</span><span class="kw">call</span><span class="st"> lt</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">HEAD</span><span class="ch">)</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">PIVOT</span><span class="ch">))</span>, 0)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="fu"> impl LIST=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">TAIL</span><span class="ch">)</span><span class="st">"</span><span class="fu"> LEFT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">LEFT</span><span class="ch">)</span><span class="st"> </span><span class="ch">$(</span><span class="dt">HEAD</span><span class="ch">)</span><span class="st">"</span><span class="fu"> PIVOT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">PIVOT</span><span class="ch">)</span><span class="st">"</span><span class="fu"> RIGHT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">RIGHT</span><span class="ch">)</span><span class="st">"</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span><span class="fu"> impl LIST=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">TAIL</span><span class="ch">)</span><span class="st">"</span><span class="fu"> LEFT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">LEFT</span><span class="ch">)</span><span class="st">"</span><span class="fu"> PIVOT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">PIVOT</span><span class="ch">)</span><span class="st">"</span><span class="fu"> RIGHT=</span><span class="st">"</span><span class="ch">$(</span><span class="dt">HEAD</span><span class="ch">)</span><span class="st"> </span><span class="ch">$(</span><span class="dt">RIGHT</span><span class="ch">)</span><span class="st">"</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Another example shows a tail-recursive implementation of the Fibonacci sequence generator. Unfortunately, to my best knowledge Makefile does not support <a href="https://stackoverflow.com/questions/310974/what-is-tail-call-optimization">tail call optimization</a> as many functional programming languages do, so it would be rather slow. The example also shows a limitation of integer type numbers, as it will overflow when using <code>NUMBER</code> over 91.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MAKEFLAGS </span><span class="ch">+=</span><span class="st"> --no-print-directory</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">NUMBER</span><span class="ch">:=</span><span class="st">0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CURRENT</span><span class="ch">:=</span><span class="st">0</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">NEXT</span><span class="ch">:=</span><span class="st">1</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dv">fibo:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">NUMBER</span><span class="ch">)</span>, 0)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    echo <span class="ch">$(</span><span class="dt">CURRENT</span><span class="ch">)</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> <span class="dt">NUMBER</span><span class="ch">=$(</span><span class="kw">shell</span><span class="st"> expr </span><span class="ch">$(</span><span class="dt">NUMBER</span><span class="ch">)</span><span class="st"> - 1</span><span class="ch">)</span><span class="st"> CURRENT=</span><span class="ch">$(</span><span class="dt">NEXT</span><span class="ch">)</span><span class="st"> NEXT=</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> expr </span><span class="ch">$(</span><span class="dt">CURRENT</span><span class="ch">)</span><span class="st"> + </span><span class="ch">$(</span><span class="dt">NEXT</span><span class="ch">))</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For other examples, here you can find <a href="https://github.com/twolodzko/MakeTicTacToe">tic-tac-toe game implemented in Make</a>, and here someone implemented <a href="https://www.cmcrossroads.com/article/learning-gnu-make-functions-arithmetic">integer arithmetics</a> in pure Makefile (no <code>expr</code> or Bash).</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>